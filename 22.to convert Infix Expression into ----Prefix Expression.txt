#include <iostream>
#include <stack>
#include <algorithm>
#include <cctype>
using namespace std;

// Operator precedence
int precedence(char ch) {
    if (ch == '^') return 3;
    if (ch == '*' || ch == '/') return 2;
    if (ch == '+' || ch == '-') return 1;
    return 0;
}

bool isOperator(char ch) {
    return (ch=='+' || ch=='-' || ch=='*' || ch=='/' || ch=='^');
}

// Convert infix to postfix (for internal use)
string convertToPostfix(string infix) {
    stack<char> st;
    string post = "";

    for (int i = 0; i < infix.length(); i++) {

        // skip spaces
        if (infix[i] == ' ') continue;

        // multi-digit number
        if (isdigit(infix[i])) {
            while (i < infix.length() && isdigit(infix[i])) {
                post += infix[i];
                i++;
            }
            post += ' ';
            i--;
        }

        else if (infix[i] == '(')
            st.push(infix[i]);

        else if (infix[i] == ')') {
            while (!st.empty() && st.top() != '(') {
                post += st.top();
                post += ' ';
                st.pop();
            }
            if (st.empty()) {
                cout << "Error: Unmatched ')'\n";
                return "";
            }
            st.pop();
        }

        else if (isOperator(infix[i])) {
            while (!st.empty() && precedence(st.top()) >= precedence(infix[i])) {
                post += st.top();
                post += ' ';
                st.pop();
            }
            st.push(infix[i]);
        }

        else {
            cout << "Error: Invalid character '" << infix[i] << "'\n";
            return "";
        }
    }

    while (!st.empty()) {
        if (st.top() == '(') {
            cout << "Error: Unmatched '('\n";
            return "";
        }
        post += st.top();
        post += ' ';
        st.pop();
    }

    return post;
}

// Main function to convert infix → prefix
string infixToPrefix(string infix) {
    // Reverse the infix
    reverse(infix.begin(), infix.end());

    // Swap parentheses
    for (int i = 0; i < infix.length(); i++) {
        if (infix[i] == '(') infix[i] = ')';
        else if (infix[i] == ')') infix[i] = '(';
    }

    // Convert reversed infix → postfix
    string postfix = convertToPostfix(infix);
    if (postfix == "") return "";  // error handling

    // Reverse postfix → prefix
    reverse(postfix.begin(), postfix.end());

    return postfix;
}

int main() {
    string infix;

    cout << "Enter Infix Expression: ";
    getline(cin, infix);

    string prefix = infixToPrefix(infix);

    if (prefix != "")
        cout << "Prefix Expression: " << prefix << endl;

    return 0;
}
