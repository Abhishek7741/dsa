#include <iostream>
using namespace std;

void printSparse(int A[][3], int t) {
    cout << "\nROW  COL  VAL\n";
    for (int i = 0; i < t; i++)
        cout << A[i][0] << "    " << A[i][1] << "    " << A[i][2] << endl;
}

// ---------------------------
// SIMPLE TRANSPOSE
// ---------------------------
void simpleTranspose(int M[][3], int T[][3]) {
    int rows = M[0][0], cols = M[0][1], t = M[0][2];

    T[0][0] = cols;
    T[0][1] = rows;
    T[0][2] = t;

    int k = 1;
    for (int col = 0; col < cols; col++) {
        for (int i = 1; i <= t; i++) {
            if (M[i][1] == col) {
                T[k][0] = M[i][1];
                T[k][1] = M[i][0];
                T[k][2] = M[i][2];
                k++;
            }
        }
    }
}

// ---------------------------
// FAST TRANSPOSE
// ---------------------------
void fastTranspose(int M[][3], int T[][3]) {
    int rows = M[0][0], cols = M[0][1], t = M[0][2];

    T[0][0] = cols;
    T[0][1] = rows;
    T[0][2] = t;

    if (t > 0) {
        int *term = new int[cols]();
        int *start = new int[cols]();

        for (int i = 1; i <= t; i++)
            term[M[i][1]]++;

        start[0] = 1;
        for (int i = 1; i < cols; i++)
            start[i] = start[i - 1] + term[i - 1];

        for (int i = 1; i <= t; i++) {
            int col = M[i][1];
            int pos = start[col]++;

            T[pos][0] = M[i][1];
            T[pos][1] = M[i][0];
            T[pos][2] = M[i][2];
        }

        delete[] term;
        delete[] start;
    }
}

int main() {

    int M[10][3] = {
        {4, 5, 5},       // rows, cols, non-zero
        {0, 3, 10},
        {1, 2, 20},
        {2, 1, 30},
        {3, 0, 40},
        {3, 4, 50}
    };

    int simpleT[10][3], fastT[10][3];

    cout << "\nOriginal Sparse Matrix:\n";
    printSparse(M, M[0][2] + 1);

    simpleTranspose(M, simpleT);
    cout << "\nSimple Transpose:\n";
    printSparse(simpleT, simpleT[0][2] + 1);

    fastTranspose(M, fastT);
    cout << "\nFast Transpose:\n";
    printSparse(fastT, fastT[0][2] + 1);

    return 0;
}
